import{c as I,j as e,A as M,R as F,u as te}from"./index-BQ2pZXqV.js";import{r as l}from"./vendor-DiiPbxpF.js";import{f as U,D as ae}from"./api-CaIsYj1h.js";import{S as P,a as re}from"./shield-DTOUMMzd.js";import{X as ne}from"./x-CqJ9GCHC.js";import{S as Q,E as q}from"./search-C1-tqQh1.js";import{U as V}from"./users-DOd0lN3S.js";import{U as k,C as ie}from"./user-DspIZNn5.js";import{C as H}from"./clock-Dtb_4Q1Y.js";import{F as Z}from"./file-text-rrVK0tAM.js";import{C as _,X as le}from"./x-circle-D0cYLFpY.js";import{A as G}from"./alert-circle-pR-S8v4m.js";import{A as B}from"./activity-zFBXjhFm.js";import{D as oe}from"./database-DkYVHlu0.js";import{T as ce}from"./trending-up-vyMYiJDz.js";import"./router-Cc-_B42c.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=I("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=I("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=I("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=I("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=I("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=I("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=I("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=I("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=I("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);class S{static async getImpersonationTargets(s){return U(`/impersonation/clients/${s}/users`)}static async startImpersonation(s){return U("/impersonation/start",{method:"POST",body:JSON.stringify(s)})}static async getCurrentSession(){try{return await U("/impersonation/session")}catch(s){if(s.status===404)return null;throw s}}static async endImpersonation(s){return U("/impersonation/end",{method:"POST",body:JSON.stringify(s||{})})}static async getImpersonationHistory(s={}){const n=new URLSearchParams;s.page&&n.append("page",s.page.toString()),s.pageSize&&n.append("pageSize",s.pageSize.toString()),s.adminUserId&&n.append("adminUserId",s.adminUserId),s.targetUserId&&n.append("targetUserId",s.targetUserId),s.fromDate&&n.append("fromDate",s.fromDate),s.toDate&&n.append("toDate",s.toDate);const m=n.toString(),h=m?`/impersonation/history?${m}`:"/impersonation/history";return U(h)}static async emergencyEndAllSessions(s){return U("/impersonation/emergency-end-all",{method:"POST",body:JSON.stringify(s)})}static async searchUsers(s){const n=new URLSearchParams({search:s});return U(`/impersonation/search?${n.toString()}`)}static async hasImpersonationPermission(){try{return await this.getImpersonationHistory({page:1,pageSize:1}),!0}catch(s){return s.status!==403}}static formatSessionDuration(s,n){const m=new Date(s),p=(n?new Date(n):new Date).getTime()-m.getTime(),g=Math.floor(p/(1e3*60*60)),u=Math.floor(p%(1e3*60*60)/(1e3*60));return g>0?`${g}h ${u}m`:`${u}m`}static isSessionExpired(s){return new Date(s)<=new Date}static getTimeUntilExpiration(s){const n=new Date,h=new Date(s).getTime()-n.getTime();if(h<=0)return"Expired";const p=Math.floor(h/(1e3*60*60)),g=Math.floor(h%(1e3*60*60)/(1e3*60));return p>0?`${p}h ${g}m remaining`:`${g}m remaining`}}function fe({isOpen:t,onClose:s,onImpersonationStarted:n}){const[m,h]=l.useState(""),[p,g]=l.useState([]),[u,y]=l.useState(null),[f,v]=l.useState([]),[x,C]=l.useState(""),[j,b]=l.useState(""),[r,o]=l.useState(4),[a,d]=l.useState(!1),[c,N]=l.useState(!1),[w,D]=l.useState(null),[E,T]=l.useState("tenant"),$=l.useRef(null);l.useEffect(()=>{t&&(X(),setTimeout(()=>{$.current?.focus()},100))},[t]),l.useEffect(()=>{const i=setTimeout(()=>{m.trim()||x?K():g([])},300);return()=>clearTimeout(i)},[m,x,E]);const X=async()=>{try{const i=await U("/clients");v(i.clients||[])}catch(i){console.error("Failed to load tenants:",i),D("Failed to load organizations. Please try again.")}},K=async()=>{if(!(!m.trim()&&!x))try{d(!0),D(null);let i=[];if(E==="tenant"&&x){if(i=await S.getImpersonationTargets(x),m.trim()){const L=m.toLowerCase();i=i.filter(A=>A.email.toLowerCase().includes(L)||A.firstName.toLowerCase().includes(L)||A.lastName.toLowerCase().includes(L))}}else E==="global"&&m.trim()&&(i=await S.searchUsers(m));const R=i.map(L=>{const A=f.find(se=>se.id===L.tenantId);return{...L,tenant:A?{name:A.name,tier:A.tier.toString(),status:A.status.toString()}:void 0}});g(R)}catch(i){console.error("Failed to search users:",i),D("Failed to search users. Please try again.")}finally{d(!1)}},W=async()=>{if(!u||!j.trim()){D("Please select a user and provide a reason for impersonation.");return}try{N(!0),D(null);const i={targetUserId:u.userId,reason:j.trim(),durationHours:r},R=await S.startImpersonation(i);n(R)}catch(i){console.error("Failed to start impersonation:",i),D(i.message||"Failed to start impersonation session.")}finally{N(!1)}},ee=i=>{if(!i)return"Never";const R=new Date(i),A=Math.floor((new Date().getTime()-R.getTime())/(1e3*60*60));return A<1?"Just now":A<24?`${A}h ago`:A<168?`${Math.floor(A/24)}d ago`:R.toLocaleDateString()};return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity",onClick:s,children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[e.jsx("div",{className:"bg-white px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-blue-600"}),"Start User Impersonation"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Search for a user to impersonate for support or troubleshooting purposes"})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ne,{className:"h-6 w-6"})})]})}),e.jsxs("div",{className:"bg-white px-6 py-4",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"tenant",checked:E==="tenant",onChange:i=>T(i.target.value),className:"mr-2"}),"Search within organization"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"global",checked:E==="global",onChange:i=>T(i.target.value),className:"mr-2"}),"Global search"]})]})}),E==="tenant"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Organization"}),e.jsxs("select",{value:x,onChange:i=>C(i.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose an organization..."}),f.map(i=>e.jsxs("option",{value:i.id,children:[i.name," (",i.tier," - ",i.status,")"]},i.id))]})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{ref:$,type:"text",value:m,onChange:i=>h(i.target.value),placeholder:E==="tenant"?"Search users in selected organization...":"Search users by email or name...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),a&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx(J,{className:"h-5 w-5 text-gray-400 animate-spin"})})]}),w&&e.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx(M,{className:"h-5 w-5 text-red-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:w})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Search Results (",p.length,")"]}),e.jsxs("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:[p.map(i=>e.jsx("div",{onClick:()=>y(i),className:`p-3 rounded-lg border cursor-pointer transition-colors ${u?.userId===i.userId?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[i.firstName," ",i.lastName]}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:i.role})]}),e.jsx("p",{className:"text-sm text-gray-600",children:i.email}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),i.tenantName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),ee(i.lastLoginAt)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),i.documentCount," docs"]})]})]}),i.isImpersonationActive&&e.jsx("span",{className:"text-xs bg-orange-100 text-orange-600 px-2 py-1 rounded",children:"Active Session"})]})},i.userId)),p.length===0&&!a&&(m||x)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(V,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No users found matching your search."})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Impersonation Details"}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Selected User"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",u.firstName," ",u.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",u.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",u.role]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Organization:"})," ",u.tenantName]}),u.tenant&&e.jsxs("p",{children:[e.jsx("strong",{children:"Tier:"})," ",u.tenant.tier," (",u.tenant.status,")"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Impersonation *"}),e.jsx("textarea",{value:j,onChange:i=>b(i.target.value),placeholder:"Provide a detailed business reason for this impersonation session...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Session Duration (hours)"}),e.jsxs("select",{value:r,onChange:i=>o(Number(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:1,children:"1 hour"}),e.jsx("option",{value:2,children:"2 hours"}),e.jsx("option",{value:4,children:"4 hours"}),e.jsx("option",{value:8,children:"8 hours"}),e.jsx("option",{value:24,children:"24 hours"})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx(M,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h5",{className:"text-sm font-medium text-yellow-800",children:"Security Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"This impersonation session will be logged and audited. Only proceed if you have legitimate business reasons for accessing this user's account."})]})]})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Select a user to configure impersonation details."})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"All impersonation activities are logged for security and compliance."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),e.jsxs("button",{onClick:W,disabled:!u||!j.trim()||c,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2",children:[c&&e.jsx(J,{className:"h-4 w-4 animate-spin"}),"Start Impersonation"]})]})]})]})]})}):null}function ye({session:t,onEndImpersonation:s}){const[n,m]=l.useState(""),[h,p]=l.useState(!1);l.useEffect(()=>{const y=()=>{const v=S.getTimeUntilExpiration(t.expiresAt);m(v);const x=new Date,j=new Date(t.expiresAt).getTime()-x.getTime();p(j>0&&j<18e5)};y();const f=setInterval(y,6e4);return()=>clearInterval(f)},[t.expiresAt]);const g=()=>S.formatSessionDuration(t.startedAt),u=()=>{window.confirm("Are you sure you want to end this impersonation session?")&&s()};return e.jsx("div",{className:`w-full border-b-2 ${h?"bg-red-600 border-red-700":"bg-orange-500 border-orange-600"} text-white shadow-lg`,children:e.jsxs("div",{className:"container mx-auto px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-6 w-6 flex-shrink-0"}),e.jsx("span",{className:"font-bold text-lg",children:"IMPERSONATION MODE"})]}),e.jsx("div",{className:"hidden sm:block w-px h-8 bg-white/30"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Impersonating:"}),e.jsx("span",{className:"text-white/90",children:t.targetUserEmail})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-white/90 text-sm",children:["Tenant: ",t.targetTenantId]})]})]}),e.jsx("div",{className:"hidden lg:block w-px h-8 bg-white/30"}),e.jsxs("div",{className:"hidden lg:flex items-center space-x-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs("span",{children:["Duration: ",g()]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:h?"font-bold":"",children:n})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"lg:hidden text-sm text-right",children:[e.jsx("div",{children:g()}),e.jsx("div",{className:`text-xs ${h?"font-bold":"text-white/80"}`,children:n})]}),e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 px-4 py-2 bg-white/20 hover:bg-white/30 text-white border border-white/30 hover:border-white/50 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-white/50",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"End Impersonation"}),e.jsx("span",{className:"sm:hidden",children:"End"})]})]})]}),e.jsx("div",{className:"mt-2 sm:hidden",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-white/90",children:[e.jsxs("span",{children:["Tenant: ",t.targetTenantId]}),e.jsxs("span",{children:["Admin: ",t.adminUserEmail]})]})}),h&&e.jsx("div",{className:"mt-3 p-3 bg-red-700/50 border border-red-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5 text-red-200"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Session Expiring Soon"}),e.jsxs("p",{className:"text-xs text-red-200 mt-1",children:["This impersonation session will automatically end in ",n.toLowerCase(),". Please complete your support activities or extend the session if needed."]})]})]})}),e.jsx("div",{className:"mt-2 text-xs text-white/70",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(P,{className:"h-3 w-3"}),e.jsxs("span",{children:['All activities during this session are being logged for security and audit purposes. Reason: "',t.reason,'"']})]})})]})})}function je({currentSession:t,onRefresh:s}){const[n,m]=l.useState([]),[h,p]=l.useState(!0),[g,u]=l.useState(null),[y,f]=l.useState(!1);l.useEffect(()=>{v()},[]);const v=async()=>{try{p(!0),u(null);const a=(await S.getImpersonationHistory({page:1,pageSize:100})).items.filter(d=>d.isActive);m(a)}catch(o){console.error("Failed to load active sessions:",o),u("Failed to load active sessions. Please try again.")}finally{p(!1)}},x=()=>{v(),s()},C=o=>S.formatSessionDuration(o),j=o=>S.getTimeUntilExpiration(o),b=o=>{const a=new Date,c=new Date(o).getTime()-a.getTime();return c>0&&c<30*60*1e3},r=o=>t?.id===o.id;return h?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading active sessions..."})]})})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5 text-green-600"}),"Active Impersonation Sessions"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Currently active impersonation sessions across the platform"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Refresh"]}),n.length>1&&e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-3 py-2 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors",children:[e.jsx(M,{className:"h-4 w-4"}),"Emergency End All"]})]})]}),g&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-red-800",children:g})]})}),n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Active Sessions"}),e.jsx("p",{className:"text-gray-500",children:"There are currently no active impersonation sessions on the platform."})]}):e.jsx("div",{className:"space-y-4",children:n.map(o=>e.jsxs("div",{className:`bg-white border rounded-lg p-6 transition-colors ${r(o)?"border-blue-200 bg-blue-50":b(o.expiresAt)?"border-orange-200 bg-orange-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${r(o)?"bg-blue-100 text-blue-800":b(o.expiresAt)?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"}`,children:[e.jsx(q,{className:"h-4 w-4"}),r(o)?"Your Session":b(o.expiresAt)?"Expiring Soon":"Active"]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(H,{className:"h-4 w-4"}),C(o.startedAt)]}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${b(o.expiresAt)?"text-orange-600 font-medium":"text-gray-600"}`,children:[e.jsx(P,{className:"h-4 w-4"}),j(o.expiresAt)]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Admin:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:o.adminUserEmail})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Target:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:o.targetUserEmail})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Tenant:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:o.tenantId})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Started:"}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:new Date(o.startedAt).toLocaleString()})]})]})]})]}),e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Reason:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o.reason})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[r(o)&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:"Current Session"}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:e.jsx(ge,{className:"h-4 w-4"})})]})]}),b(o.expiresAt)&&e.jsx("div",{className:"mt-4 p-3 bg-orange-100 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-orange-600"}),e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"Warning:"})," This session will expire in ",j(o.expiresAt).toLowerCase(),"."]})]})})]},o.id))}),y&&e.jsx(be,{isOpen:y,onClose:()=>f(!1),onConfirm:x,sessionCount:n.length})]})}function be({isOpen:t,onClose:s,onConfirm:n,sessionCount:m}){const[h,p]=l.useState(""),[g,u]=l.useState(""),[y,f]=l.useState(!1),v=async()=>{if(!(g!=="EMERGENCY_END_ALL_SESSIONS"||!h.trim()))try{f(!0),await S.emergencyEndAllSessions({confirmationToken:g,reason:h.trim()}),n(),s()}catch(x){console.error("Failed to emergency end sessions:",x)}finally{f(!1)}};return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity",onClick:s,children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsxs("div",{className:"bg-white px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(M,{className:"h-6 w-6 text-red-600"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Emergency End All Sessions"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Warning:"})," This action will immediately terminate all ",m," active impersonation sessions across the platform. This action cannot be undone."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Emergency Termination *"}),e.jsx("textarea",{value:h,onChange:x=>p(x.target.value),placeholder:"Provide a detailed reason for this emergency action...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmation Token *"}),e.jsx("input",{type:"text",value:g,onChange:x=>u(x.target.value),placeholder:"Type: EMERGENCY_END_ALL_SESSIONS",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-red-500 focus:border-red-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Type "EMERGENCY_END_ALL_SESSIONS" to confirm this action'})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:g!=="EMERGENCY_END_ALL_SESSIONS"||!h.trim()||y,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:y?"Ending Sessions...":"End All Sessions"})]})]})]})}):null}function Ne(){const[t,s]=l.useState({items:[],totalCount:0,page:1,pageSize:20,totalPages:0}),[n,m]=l.useState({search:"",adminUserId:"",targetUserId:"",fromDate:"",toDate:"",sessionStatus:"all"}),[h,p]=l.useState(!0),[g,u]=l.useState(null),[y,f]=l.useState(!1);l.useEffect(()=>{v()},[t.page,n]);const v=async()=>{try{p(!0),u(null);const a=await S.getImpersonationHistory({page:t.page,pageSize:t.pageSize,...n.adminUserId&&{adminUserId:n.adminUserId},...n.targetUserId&&{targetUserId:n.targetUserId},...n.fromDate&&{fromDate:n.fromDate},...n.toDate&&{toDate:n.toDate}});let d=a.items;if(n.search){const c=n.search.toLowerCase();d=d.filter(N=>N.adminUserEmail.toLowerCase().includes(c)||N.targetUserEmail.toLowerCase().includes(c)||N.reason.toLowerCase().includes(c)||N.tenantId.toLowerCase().includes(c))}n.sessionStatus!=="all"&&(d=d.filter(c=>{switch(n.sessionStatus){case"active":return c.isActive;case"completed":return!c.isActive&&c.endedAt;case"expired":return!c.isActive&&!c.endedAt;default:return!0}})),s({...a,items:d})}catch(a){console.error("Failed to load impersonation history:",a),u("Failed to load impersonation history. Please try again.")}finally{p(!1)}},x=(a,d)=>{m(c=>({...c,[a]:d})),s(c=>({...c,page:1}))},C=a=>{s(d=>({...d,page:a}))},j=()=>{m({search:"",adminUserId:"",targetUserId:"",fromDate:"",toDate:"",sessionStatus:"all"})},b=a=>{if(a<60)return`${Math.round(a)}m`;const d=Math.floor(a/60),c=Math.round(a%60);return`${d}h ${c}m`},r=a=>a.isActive?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(_,{className:"h-3 w-3"}),"Active"]}):a.endedAt?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(_,{className:"h-3 w-3"}),"Completed"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[e.jsx(le,{className:"h-3 w-3"}),"Expired"]}),o=()=>{const a=[["Session ID","Admin Email","Target Email","Tenant ID","Reason","Started At","Ended At","Duration (minutes)","Status","End Reason","Admin IP"].join(","),...t.items.map(w=>[w.id,w.adminUserEmail,w.targetUserEmail,w.tenantId,`"${w.reason}"`,w.startedAt,w.endedAt||"",w.durationMinutes.toFixed(1),w.isActive?"Active":"Ended",w.endReason||"",w.adminIPAddress||""].join(","))].join(`
`),d=new Blob([a],{type:"text/csv"}),c=window.URL.createObjectURL(d),N=document.createElement("a");N.href=c,N.download=`impersonation-history-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(N),N.click(),document.body.removeChild(N),window.URL.revokeObjectURL(c)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-purple-600"}),"Impersonation History"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Complete audit trail of all impersonation sessions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>f(!y),className:`flex items-center gap-2 px-3 py-2 text-sm rounded-lg transition-colors ${y?"bg-blue-100 text-blue-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:[e.jsx(he,{className:"h-4 w-4"}),"Filters"]}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-3 py-2 text-sm bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors",children:[e.jsx(ae,{className:"h-4 w-4"}),"Export"]}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Refresh"]})]})]}),y&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:n.search,onChange:a=>x("search",a.target.value),placeholder:"Search emails, reasons, tenants...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:n.fromDate,onChange:a=>x("fromDate",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:n.toDate,onChange:a=>x("toDate",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:n.sessionStatus,onChange:a=>x("sessionStatus",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"All Sessions"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"expired",children:"Expired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin User ID"}),e.jsx("input",{type:"text",value:n.adminUserId,onChange:a=>x("adminUserId",a.target.value),placeholder:"Filter by admin user ID...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target User ID"}),e.jsx("input",{type:"text",value:n.targetUserId,onChange:a=>x("targetUserId",a.target.value),placeholder:"Filter by target user ID...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:j,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800 transition-colors",children:"Clear all filters"})})]}),g&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-red-800",children:g})]})}),e.jsxs("div",{className:"mb-4 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Showing ",t.items.length," of ",t.totalCount," sessions"]}),e.jsxs("span",{children:["Page ",t.page," of ",t.totalPages]})]}),h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading history..."})]})}):t.items.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No History Found"}),e.jsx("p",{className:"text-gray-500",children:"No impersonation sessions match your current filters."})]}):e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Session Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Users"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.items.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[a.id.substring(0,8),"..."]}),e.jsxs("div",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),new Date(a.startedAt).toLocaleString()]}),e.jsxs("div",{className:"text-gray-500 flex items-center gap-1 mt-1",children:[e.jsx(z,{className:"h-3 w-3"}),a.tenantId.substring(0,8),"..."]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(k,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-500",children:"Admin:"}),e.jsx("span",{className:"text-gray-900",children:a.adminUserEmail})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3 text-blue-500"}),e.jsx("span",{className:"text-gray-500",children:"Target:"}),e.jsx("span",{className:"text-gray-900",children:a.targetUserEmail})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"font-medium",children:b(a.durationMinutes)})]}),a.endedAt&&e.jsxs("div",{className:"text-gray-500 text-xs mt-1",children:["Ended: ",new Date(a.endedAt).toLocaleString()]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[r(a),a.endReason&&e.jsx("span",{className:"text-xs text-gray-500",children:a.endReason})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"text-sm text-gray-900 max-w-xs",children:[e.jsx("p",{className:"truncate",title:a.reason,children:a.reason}),a.adminIPAddress&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["IP: ",a.adminIPAddress]})]})})]},a.id))})]})}),t.totalPages>1&&e.jsxs("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>C(t.page-1),disabled:t.page===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>C(t.page+1),disabled:t.page===t.totalPages,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:"Next"})]}),e.jsxs("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(t.page-1)*t.pageSize+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(t.page*t.pageSize,t.totalCount)})," ","of"," ",e.jsx("span",{className:"font-medium",children:t.totalCount})," ","results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>C(t.page-1),disabled:t.page===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:e.jsx(me,{className:"h-5 w-5"})}),Array.from({length:Math.min(5,t.totalPages)},(a,d)=>{const c=d+1;return e.jsx("button",{onClick:()=>C(c),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${c===t.page?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:c},c)}),e.jsx("button",{onClick:()=>C(t.page+1),disabled:t.page===t.totalPages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:bg-gray-100 disabled:cursor-not-allowed",children:e.jsx(ie,{className:"h-5 w-5"})})]})})]})]})]})]})}function ve({currentSession:t}){const[s,n]=l.useState(null),[m,h]=l.useState(""),[p,g]=l.useState(!1),[u,y]=l.useState(null),[f,v]=l.useState("profile");l.useEffect(()=>{t?x():n(null)},[t]);const x=async()=>{if(t)try{g(!0),y(null);const r={user:{id:t.targetUserId,firstName:t.targetUserEmail.split("@")[0]||"Unknown",lastName:"User",email:t.targetUserEmail,fullName:t.targetUserEmail.split("@")[0]+" User",isActive:!0,createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-07-25T15:30:00Z",lastLoginAt:"2024-07-25T14:20:00Z",tenantId:t.targetTenantId,profile:{jobTitle:"Senior Manager",department:"Operations",industry:"Technology",phoneNumber:"+1 (555) 123-4567",timeZone:"America/New_York",language:"en",customFields:{}},settings:{enableAIAssistance:!0,enableAutoDocumentation:!0,enableVoiceCapture:!1,enableScreenCapture:!1,enableFileMonitoring:!1,privacyLevel:"Standard",allowDataRetention:!0,dataRetentionDays:365,enableEmailNotifications:!0,enablePushNotifications:!0,enableSlackNotifications:!1,enableTeamsNotifications:!1,theme:"light",defaultDocumentType:"general",favoriteAgents:[],moduleSettings:{},customSettings:{}},userRoles:[]},tenant:{id:t.targetTenantId,name:"Example Corporation",subdomain:"example-corp",description:"A leading technology company",status:"Active",tier:"Professional",createdAt:"2024-01-01T00:00:00Z",updatedAt:"2024-07-25T12:00:00Z",billing:{subscriptionId:"sub_1234567890",planId:"pro_plan",subscriptionStartDate:"2024-01-01T00:00:00Z",nextBillingDate:"2024-08-01T00:00:00Z",monthlyRate:299.99,currency:"USD",isTrialActive:!1,paymentStatus:"Current",documentsCreatedThisMonth:125,apiCallsThisMonth:4567,storageUsedBytes:1024*1024*1024*2.5,billingMetadata:{}},configuration:{requireMFA:!0,requireSSO:!1,passwordExpiryDays:90,sessionTimeoutMinutes:480,documentRetentionDays:2555,auditLogRetentionDays:2555,enableDataExport:!0,enableAIFeatures:!0,enableAutoDocumentation:!0,enableVoiceCapture:!1,enableScreenCapture:!1,enabledIntegrations:{sharepoint:!0,teams:!1},complianceFrameworks:["SOC2","GDPR"],enableAuditLogging:!0,enableDataEncryption:!0,defaultTimeZone:"America/New_York",defaultLanguage:"en",customSettings:{}},quotas:{maxStorageBytes:1024*1024*1024*10,usedStorageBytes:1024*1024*1024*2.5,maxUsers:50,activeUsers:23,maxDocumentsPerMonth:500,documentsCreatedThisMonth:125,maxAPICallsPerMonth:1e4,apiCallsThisMonth:4567,maxAIProcessingMinutesPerMonth:1e3,aiProcessingMinutesUsedThisMonth:234,moduleQuotas:{},quotaResetDate:"2024-08-01T00:00:00Z"},branding:{companyName:"Example Corporation",primaryColor:"#0066CC",hidePlatformBranding:!1,customDomain:!1,customLabels:{}},modules:[]},recentDocuments:[{id:"1",title:"Q3 Project Review",content:"Comprehensive review of Q3 project deliverables...",documentType:"project-review",industry:"technology",status:"Published",createdAt:"2024-07-24T16:00:00Z",updatedAt:"2024-07-24T16:30:00Z",createdBy:t.targetUserId,tenantId:t.targetTenantId,metadata:{properties:{},keywords:["project","review","Q3"],summary:"Q3 project review document",wordCount:1247,language:"en"},version:1,childDocuments:[],tags:[],attachments:[],permissions:[],auditEntries:[]}],userActivity:[{id:"1",action:"Document Created",timestamp:"2024-07-25T14:30:00Z",details:"Created document: Q3 Project Review",ipAddress:"192.168.1.100"},{id:"2",action:"Login",timestamp:"2024-07-25T14:20:00Z",details:"User logged in successfully",ipAddress:"192.168.1.100"}],supportTickets:[{id:"TICK-001",title:"Unable to export documents",status:"in-progress",priority:"medium",createdAt:"2024-07-23T10:00:00Z",lastUpdated:"2024-07-24T15:30:00Z",assignee:"Sarah Johnson"}],systemHealth:{apiResponseTime:145,databaseHealth:!0,storageStatus:"healthy",lastBackup:"2024-07-25T02:00:00Z",activeUsers:23}};n(r)}catch(r){console.error("Failed to load user context:",r),y("Failed to load user context information.")}finally{g(!1)}},C=()=>{m.trim()&&(console.log("Adding session note:",m),h(""))},j=r=>{const o=["Bytes","KB","MB","GB","TB"];if(r===0)return"0 Bytes";const a=Math.floor(Math.log(r)/Math.log(1024));return Math.round(r/Math.pow(1024,a)*100)/100+" "+o[a]},b=()=>s?s.tenant.quotas.usedStorageBytes/s.tenant.quotas.maxStorageBytes*100:0;return t?p?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 animate-pulse mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading customer context..."})]})})}):u||!s?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-red-800",children:u||"Failed to load customer context"})]})})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600"}),"Customer Support Context"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Complete customer information for ",s.user.fullName]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"profile",label:"Profile",icon:k},{id:"activity",label:"Activity",icon:B},{id:"documents",label:"Documents",icon:Z},{id:"support",label:"Support",icon:O},{id:"system",label:"System",icon:oe}].map(r=>{const o=r.icon;return e.jsxs("button",{onClick:()=>v(r.id),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center gap-2 ${f===r.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(o,{className:"h-4 w-4"}),r.label]},r.id)})})}),e.jsxs("div",{className:"space-y-6",children:[f==="profile"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"User Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium",children:s.user.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email:"}),e.jsx("span",{className:"font-medium",children:s.user.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Job Title:"}),e.jsx("span",{className:"font-medium",children:s.user.profile.jobTitle})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Department:"}),e.jsx("span",{className:"font-medium",children:s.user.profile.department})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Phone:"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),s.user.profile.phoneNumber]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Last Login:"}),e.jsx("span",{className:"font-medium",children:s.user.lastLoginAt&&new Date(s.user.lastLoginAt).toLocaleString()})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Organization"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Company:"}),e.jsx("span",{className:"font-medium",children:s.tenant.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tier:"}),e.jsx("span",{className:"font-medium",children:s.tenant.tier})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:"font-medium",children:s.tenant.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Users:"}),e.jsxs("span",{className:"font-medium",children:[s.tenant.quotas.activeUsers," / ",s.tenant.quotas.maxUsers]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Storage:"}),e.jsxs("span",{className:"font-medium",children:[j(s.tenant.quotas.usedStorageBytes)," / ",j(s.tenant.quotas.maxStorageBytes)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Monthly Rate:"}),e.jsxs("span",{className:"font-medium",children:["$",s.tenant.billing.monthlyRate," ",s.tenant.billing.currency]})]})]})]})]}),f==="activity"&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Recent User Activity"]}),e.jsx("div",{className:"space-y-3",children:s.userActivity.map(r=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.action}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:r.details}),r.ipAddress&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["IP: ",r.ipAddress]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(r.timestamp).toLocaleString()})]})},r.id))})]}),f==="documents"&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Recent Documents"]}),e.jsx("div",{className:"space-y-3",children:s.recentDocuments.map(r=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[r.title,e.jsx(xe,{className:"h-3 w-3 text-gray-400"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[r.documentType,"  ",r.metadata.wordCount," words"]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Status: ",r.status]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString()})]})},r.id))})]}),f==="support"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Support Tickets"]}),e.jsx("div",{className:"space-y-3",children:s.supportTickets.map(r=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.status==="open"?"bg-red-100 text-red-800":r.status==="in-progress"?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:r.status}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${r.priority==="critical"?"bg-red-100 text-red-800":r.priority==="high"?"bg-orange-100 text-orange-800":r.priority==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:r.priority})]}),r.assignee&&e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Assigned to: ",r.assignee]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString()})]})},r.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Session Notes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:m,onChange:r=>h(r.target.value),placeholder:"Add notes about this support session...",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{onClick:C,disabled:!m.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Add Note"})]})]})]}),f==="system"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"System Health"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"API Response Time:"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.systemHealth.apiResponseTime,"ms"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Database Health:"}),e.jsx("span",{className:`text-sm font-medium ${s.systemHealth.databaseHealth?"text-green-600":"text-red-600"}`,children:s.systemHealth.databaseHealth?"Healthy":"Issues Detected"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Storage Status:"}),e.jsx("span",{className:`text-sm font-medium capitalize ${s.systemHealth.storageStatus==="healthy"?"text-green-600":s.systemHealth.storageStatus==="warning"?"text-yellow-600":"text-red-600"}`,children:s.systemHealth.storageStatus})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Backup:"}),e.jsx("span",{className:"text-sm font-medium",children:new Date(s.systemHealth.lastBackup).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active Users:"}),e.jsx("span",{className:"text-sm font-medium",children:s.systemHealth.activeUsers})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Usage Statistics"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Storage Usage:"}),e.jsxs("span",{className:"font-medium",children:[b().toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${b()}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Documents This Month:"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.tenant.billing.documentsCreatedThisMonth," / ",s.tenant.quotas.maxDocumentsPerMonth]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"API Calls This Month:"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.tenant.billing.apiCallsThisMonth," / ",s.tenant.quotas.maxAPICallsPerMonth]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"AI Processing:"}),e.jsxs("span",{className:"text-sm font-medium",children:[s.tenant.quotas.aiProcessingMinutesUsedThisMonth," / ",s.tenant.quotas.maxAIProcessingMinutesPerMonth," min"]})]})]})]})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Active Session"}),e.jsx("p",{className:"text-gray-500",children:"Start an impersonation session to view customer context and support information."})]})})}function we(){te();const[t,s]=l.useState(null),[n,m]=l.useState(!1),[h,p]=l.useState("active"),[g,u]=l.useState({totalSessions:0,activeSessions:0,todaySessions:0,averageDuration:0}),[y,f]=l.useState(!0),[v,x]=l.useState(null),[C,j]=l.useState(!1);l.useEffect(()=>{(async()=>{try{f(!0),x(null);const c=await S.hasImpersonationPermission();if(j(c),!c){x("You do not have permission to access the impersonation system.");return}const N=await S.getCurrentSession();s(N),await b()}catch(c){console.error("Failed to initialize impersonation dashboard:",c),x("Failed to load impersonation dashboard. Please try again.")}finally{f(!1)}})()},[]);const b=async()=>{try{const d=await S.getImpersonationHistory({page:1,pageSize:100}),c=new Date;c.setHours(0,0,0,0);const N=d.items.filter(T=>new Date(T.startedAt)>=c).length,w=d.items.filter(T=>T.isActive).length,D=d.items.filter(T=>!T.isActive),E=D.length>0?D.reduce((T,$)=>T+$.durationMinutes,0)/D.length:0;u({totalSessions:d.totalCount,activeSessions:w,todaySessions:N,averageDuration:E})}catch(d){console.error("Failed to load dashboard stats:",d)}},r=d=>{s(d),m(!1),b()},o=async()=>{try{await S.endImpersonation({reason:"Manual termination from dashboard"}),s(null),b()}catch(d){console.error("Failed to end impersonation:",d),x("Failed to end impersonation session.")}},a=async()=>{await b();const d=await S.getCurrentSession();s(d)};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading impersonation dashboard..."})]})}):C?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t&&e.jsx(ye,{session:t,onEndImpersonation:o}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(P,{className:"h-8 w-8 text-blue-600"}),"User Impersonation & Support"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Secure user impersonation for customer support and troubleshooting"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[e.jsx(F,{className:"h-4 w-4"}),"Refresh"]}),e.jsxs("button",{onClick:()=>m(!0),disabled:t!==null,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-lg transition-colors",children:[e.jsx(Q,{className:"h-4 w-4"}),"Start Impersonation"]})]})]})}),v&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-red-500"}),e.jsx("p",{className:"text-red-800",children:v}),e.jsx("button",{onClick:()=>x(null),className:"ml-auto text-red-500 hover:text-red-700",children:""})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.totalSessions})]}),e.jsx(Y,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.activeSessions})]}),e.jsx(q,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Today's Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:g.todaySessions})]}),e.jsx(H,{className:"h-8 w-8 text-purple-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Avg Duration"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[Math.round(g.averageDuration),"m"]})]}),e.jsx(re,{className:"h-8 w-8 text-orange-600"})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>p("active"),className:`py-2 px-1 border-b-2 font-medium text-sm ${h==="active"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Active Sessions"}),e.jsx("button",{onClick:()=>p("history"),className:`py-2 px-1 border-b-2 font-medium text-sm ${h==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Session History"}),e.jsx("button",{onClick:()=>p("context"),className:`py-2 px-1 border-b-2 font-medium text-sm ${h==="context"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Support Context"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[h==="active"&&e.jsx(je,{currentSession:t,onRefresh:a}),h==="history"&&e.jsx(Ne,{}),h==="context"&&e.jsx(ve,{currentSession:t})]})]}),n&&e.jsx(fe,{isOpen:n,onClose:()=>m(!1),onImpersonationStarted:r})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(P,{className:"h-16 w-16 mx-auto mb-4 text-red-500"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You do not have permission to access the impersonation system. Please contact your administrator if you believe this is an error."}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Required permissions:"})," Platform.Admin or Platform.Support role"]})})]})})}function $e(){return e.jsx(we,{})}export{$e as default};
